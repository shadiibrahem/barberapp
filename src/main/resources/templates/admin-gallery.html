<!doctype html>
<html xmlns:th="http://www.thymeleaf.org"
      th:with="lang=${#locale.language}, rtl=${lang == 'ar' or lang == 'he'}"
      th:lang="${lang}"
      th:dir="${rtl} ? 'rtl' : 'ltr'">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="#{galleryAdmin.pageTitle}">Gallery Management</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body class="bg-light">
<div class="container py-4">

    <div class="d-flex justify-content-between align-items-center mb-3">
        <h3 class="m-0" th:text="#{galleryAdmin.title}">üì∏ Manage Gallery</h3>
        <a th:href="@{/admin}" class="btn btn-secondary" th:text="#{galleryAdmin.back}">Back</a>
    </div>

    <!-- =========================
         1) UPLOAD FROM PHONE
         ========================= -->
    <form class="card p-3 mb-3"
          method="post"
          th:action="@{/admin/gallery/upload}"
          enctype="multipart/form-data">

        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">

        <label class="form-label fw-semibold" th:text="#{galleryAdmin.uploadTitle}">Upload Image</label>

        <input class="form-control"
               type="file"
               name="file"
               accept="image/*"
               capture="environment"
               required>

        <button class="btn btn-success mt-3" type="submit" th:text="#{galleryAdmin.uploadBtn}">
            Upload
        </button>

        <div class="text-muted mt-2" style="font-size:.9rem" th:text="#{galleryAdmin.uploadTip}">
            Tip: From phone you can choose camera or gallery.
        </div>
    </form>

    <!-- =========================
         2) ADD BY DIRECT URL (OPTIONAL)
         ========================= -->
    <form class="card p-3 mb-3" method="post" th:action="@{/admin/gallery/add}">
        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">

        <label class="form-label fw-semibold" th:text="#{galleryAdmin.url}">Image URL</label>

        <input class="form-control"
               name="imageUrl"
               th:placeholder="#{galleryAdmin.placeholder}"
               required>

        <button class="btn btn-primary mt-3" type="submit" th:text="#{galleryAdmin.add}">
            Add Image
        </button>

        <div class="text-muted mt-2" style="font-size:.9rem" th:text="#{galleryAdmin.tip}">
            Tip: Use direct image link (.jpg / .png)
        </div>
    </form>

    <!-- =========================
         3) GALLERY GRID
         ========================= -->
    <div class="row g-3">
        <div class="col-6 col-md-3" th:each="img : ${images}">
            <div class="card h-100 shadow-sm">

                <img th:src="${img.imageUrl}"
                     class="card-img-top"
                     style="height:160px; object-fit:cover;"
                     alt="gallery"
                     onerror="this.style.display='none'; this.closest('.card').querySelector('.img-error').style.display='block';">

                <div class="p-3 img-error text-center text-muted" style="display:none;">
                    ‚ùå Image not loading
                </div>

                <div class="card-body">
                    <form method="post"
                          th:action="@{/admin/gallery/delete}"
                          class="confirm-form"
                          th:attr="data-confirm=#{galleryAdmin.confirmDelete}">
                        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
                        <input type="hidden" name="id" th:value="${img.id}">
                        <button class="btn btn-danger w-100" type="submit" th:text="#{galleryAdmin.delete}">
                            Delete
                        </button>
                    </form>
                </div>

            </div>
        </div>
    </div>

</div>

<script>
    document.addEventListener('submit', function (e) {
      const form = e.target.closest('.confirm-form');
      if (!form) return;

      const msg = form.getAttribute('data-confirm') || 'Are you sure?';
      if (!confirm(msg)) {
        e.preventDefault();
        e.stopPropagation();
      }
    });
</script>

</body>
</html>