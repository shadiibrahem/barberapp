<!doctype html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>حجز موعد</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet"/>

    <style>
        body{
            font-family:'Cairo',sans-serif;
            background:#f6f7f9;
            color:#222;
        }
        .wrap{ max-width: 760px; }

        .topbar{
            background:#fff;
            padding: 28px 0 18px;
            border-bottom: 1px solid #e5e7eb;
        }
        .brand{
            display:flex; align-items:center; justify-content:center; gap:10px;
            font-weight:900;
            color:#111;
        }
        .brand i{ color:#3b82f6; }
        .subtitle{
            text-align:center;
            color:#6b7280;
            margin-top:6px;
            font-size:.95rem;
        }

        .card-pro{
            background:#fff;
            border:1px solid #e5e7eb;
            border-radius:20px;
            box-shadow:0 6px 25px rgba(0,0,0,.05);
        }

        .section-h{
            display:flex;
            align-items:center;
            gap:10px;
            font-weight:900;
            color:#111;
            margin-bottom:14px;
        }
        .section-h i{ color:#3b82f6; }

        .form-label{
            font-weight:800;
            color:#111;
        }

        .form-control, .form-select{
            border-radius:14px;
            padding:12px;
            border:1px solid #e5e7eb;
            background:#fff;
        }
        .form-control:focus, .form-select:focus{
            border-color:#3b82f6;
            box-shadow: 0 0 0 3px rgba(59,130,246,.15);
        }

        .note{
            font-size:.9rem;
            color:#6b7280;
        }

        .btn-primary-clean{
            background:#3b82f6;
            border:0;
            color:#fff;
            font-weight:900;
            padding:12px;
            border-radius:14px;
            transition:.2s;
        }
        .btn-primary-clean:hover{ background:#2563eb; }

        .btn-outline-clean{
            border-radius:14px;
            border:1px solid #cbd5e1;
            color:#111;
            background:#fff;
            padding:10px 16px;
        }
        .btn-outline-clean:hover{
            background:#f1f5f9;
        }

        .alert-error{
            background:#fff1f2;
            border:1px solid #fecdd3;
            color:#9f1239;
            border-radius:14px;
        }
        .alert-info-clean{
            background:#eff6ff;
            border:1px solid #bfdbfe;
            color:#1d4ed8;
            border-radius:14px;
        }

        /* disable look */
        .is-disabled{
            opacity:.75;
        }
    </style>
</head>

<body>

<!-- TOP BAR -->
<div class="topbar">
    <div class="container wrap">
        <div class="brand">
            <i class="fa-solid fa-calendar-check"></i>
            <div>حجز موعد</div>
        </div>
        <div class="subtitle">اختر الخدمة والتاريخ ثم أكد الحجز بسهولة</div>
    </div>
</div>

<div class="container py-4 wrap">

    <!-- error (booked or dayoff) -->
    <div th:if="${param.error}" class="alert alert-error text-center mb-3">
        <i class="fa-solid fa-circle-xmark ms-2"></i>
        هذا الوقت غير متاح، اختر وقتًا آخر.
    </div>

    <!-- Day off message -->
    <div th:if="${isDayOff}" class="alert alert-info-clean text-center mb-3">
        <i class="fa-solid fa-ban ms-2"></i>
        <span th:text="${dayOffMessage}">هذا اليوم عطلة / مغلق. اختر يومًا آخر.</span>
    </div>

    <!-- STEP 1 -->
    <div class="card card-pro p-4 mb-3">
        <div class="section-h">
            <i class="fa-solid fa-calendar-days"></i>
            <span>اختيار الخدمة والتاريخ</span>
        </div>

        <form method="get" action="/book" id="autoForm">
            <div class="mb-3">
                <label class="form-label">التاريخ</label>
                <input class="form-control"
                       type="date"
                       name="date"
                       id="dateInput"
                       th:value="${selectedDate}">
            </div>

            <div class="mb-2">
                <label class="form-label">الخدمة</label>
                <select class="form-select" name="serviceId" id="serviceSelect">
                    <option th:each="s : ${services}"
                            th:value="${s.id}"
                            th:selected="${s.id == selectedServiceId}"
                            th:text="${s.name + ' - ' + s.price + ' ₪'}">
                    </option>
                </select>
            </div>
        </form>

        <div class="note mt-2">
            يتم تحديث الأوقات تلقائيًا عند تغيير التاريخ أو الخدمة.
        </div>
    </div>

    <!-- STEP 2 -->
    <div class="card card-pro p-4" th:classappend="${isDayOff} ? ' is-disabled' : ''">
        <div class="section-h">
            <i class="fa-solid fa-user-check"></i>
            <span>أدخل بياناتك</span>
        </div>

        <form method="post" action="/book">

            <input type="hidden" name="date" id="hiddenDate" th:value="${selectedDate}">
            <input type="hidden" name="serviceId" id="hiddenServiceId" th:value="${selectedServiceId}">

            <div class="mb-3">
                <label class="form-label">الاسم</label>
                <input class="form-control" name="customerName" required th:disabled="${isDayOff}">
            </div>

            <div class="mb-3">
                <label class="form-label">رقم الهاتف</label>
                <input class="form-control" name="phone" required th:disabled="${isDayOff}">
            </div>

            <div class="mb-3">
                <label class="form-label">الوقت المتاح</label>
                <select class="form-select" name="time" required th:disabled="${isDayOff}">
                    <option value="" disabled selected>اختر وقتًا</option>
                    <option th:each="t : ${slots}" th:value="${t}" th:text="${t}"></option>
                </select>

                <div class="note mt-2">
                    إذا لم تظهر أوقات، غيّر الخدمة أو التاريخ وسيتم تحديثها تلقائيًا.
                </div>
            </div>

            <button class="btn btn-primary-clean w-100" th:disabled="${isDayOff}">
                <i class="fa-solid fa-check ms-2"></i>
                تأكيد الحجز
            </button>

        </form>
    </div>

    <div class="text-center mt-3">
        <a href="/" class="btn btn-outline-clean">
            <i class="fa-solid fa-arrow-right ms-2"></i>
            الرجوع للرئيسية
        </a>
    </div>

</div>

<script>
    const dateInput = document.getElementById('dateInput');
    const serviceSelect = document.getElementById('serviceSelect');
    const hiddenDate = document.getElementById('hiddenDate');
    const hiddenServiceId = document.getElementById('hiddenServiceId');
    const autoForm = document.getElementById('autoForm');

    function syncHidden() {
        if (hiddenDate) hiddenDate.value = dateInput.value;
        if (hiddenServiceId) hiddenServiceId.value = serviceSelect.value;
    }

    function autoSubmit() {
        syncHidden();
        autoForm.submit();
    }

    dateInput.addEventListener('change', autoSubmit);
    serviceSelect.addEventListener('change', autoSubmit);

    syncHidden();
</script>

</body>
</html>